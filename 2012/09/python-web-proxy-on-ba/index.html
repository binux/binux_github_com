<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>运行于百度云平台的Python网页代理 | Binuxの杂货铺</title>
  <meta name="author" content="Roy Binux">
  
  <meta name="description" content="最近看到好多求BAE邀请的帖子，至少现在免费，于是也去求了一个，然后顺带开了python权限。随便看了下python环境，版本够新，该有的库和框架也比较齐全，fetchurl接口完全封装在内置库中，至少比起GAE来说，迁移成本低多了。沙盒也是恰到好处的感觉，初步感觉不错。提供的服务也涉及各个方面，云">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="运行于百度云平台的Python网页代理"/>
  <meta property="og:site_name" content="Binuxの杂货铺"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
    <link rel="alternate" href="/atom.xml" title="Binuxの杂货铺" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-36392342-1', 'auto');
	ga('send', 'pageview');

</script>


<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Binuxの杂货铺</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/null">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/projects">Projects</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-python-web-proxy-on-ba" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2012-09-07T19:28:37.000Z"><a href="/2012/09/python-web-proxy-on-ba/">2012-09-07</a></time>
      
      
  
    <h1 class="p-name title" itemprop="headline name">运行于百度云平台的Python网页代理</h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>最近看到好多求BAE邀请的帖子，至少现在免费，于是也去求了一个，然后顺带开了python权限。<br>随便看了下python环境，版本够新，该有的库和框架也比较齐全，fetchurl接口完全封装在内置库中，至少比起GAE来说，迁移成本低多了。沙盒也是恰到好处的感觉，初步感觉不错。<br>提供的服务也涉及各个方面，云存储，数据库，cache，队列该有的都有了。<br>fetch taskqueue能fetchurl和离线下载（支持最大4G，10小时下载）体现了百度的特色吧，感觉眼前一亮，虽然已经有百度网盘提供类似服务，但是作为开发平台，也能作出一些有意思的应用。<br>消息服务自带1000条短信1W封邮件每月。</p>
<p>不过，百度依然体现了没有设计师的特色，界面和各个服务的开发包各不相同。。</p>
<p>由于BAE政策和稳定性尚不明朗，不打算在上面做能够保存数据的应用。<br>于是，做一个网页代理吧</p>
<p><a target="_blank" rel="noopener" href="http://pyproxy.duapp.com/https://github.com/binux">http://pyproxy.duapp.com/https://github.com/binux</a></p>
<p>其他API：  </p>
<p><a target="_blank" rel="noopener" href="http://pyproxy.duapp.com/rewrite/http://www.baidu.com/">http://pyproxy.duapp.com/rewrite/http://www.baidu.com/</a><br>使用这个地址访问会将页面上的url都加上代理的前缀</p>
<p><a target="_blank" rel="noopener" href="http://pyproxy.duapp.com/allow_origin/http://httpbin.duapp.com/ip">http://pyproxy.duapp.com/allow_origin&#x2F;http://httpbin.duapp.com/ip</a><br>用于ajax跨域读取，比如这样：<br>您的IP是：<span id="origin_ip"></span> 请自行查看源码  </p>
<script src="http://lib.sinaapp.com/js/jquery/1.8.3/jquery.min.js"></script>
<script>
 $.get("http://pyproxy.duapp.com/allow_origin/http://httpbin.duapp.com/ip",
  function(data) {
  $("#origin_ip").text(data.origin);
});
</script>

<p>不得不说，百度网速也太不怎么样了吧。。<br>第一次写网页代理，地址改写还真麻烦，xmlhttprequest好歹是拦截了，js动态加载的元素就算了。。</p>
<p>附上rewrite代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># vim: set et sw=4 ts=4 sts=4 ff=unix fenc=utf8:</span></span><br><span class="line"><span class="comment"># Author: Binux&lt;17175297.hk@gmail.com&gt;</span></span><br><span class="line"><span class="comment">#         http://binux.me</span></span><br><span class="line"><span class="comment"># Created on 2012-09-06 22:22:21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">xmlhttprequest = <span class="string">&#x27;&#x27;&#x27;XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open;</span></span><br><span class="line"><span class="string">XMLHttpRequest.prototype.open = function(m,u,a,us,p) &#123;</span></span><br><span class="line"><span class="string">  var proxyurl=&#x27;%s&#x27;, baseurl=&#x27;%s&#x27;, a=document.createElement(&#x27;a&#x27;);</span></span><br><span class="line"><span class="string">  a.href=u;u=a.href.replace(proxyurl,&#x27;&#x27;);u=proxyurl+(u.indexOf(&#x27;http&#x27;)==0?u:baseurl+u);</span></span><br><span class="line"><span class="string">  if(console&amp;&amp;console.log)&#123;console.log(&quot;XMLHTTPRequest:&quot;,u);&#125;</span></span><br><span class="line"><span class="string">  return this._open(m,u,a,us,p);</span></span><br><span class="line"><span class="string">&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line">http_re = re.<span class="built_in">compile</span>(<span class="string">&quot;https?://&quot;</span>, re.I)</span><br><span class="line">href_re1 = re.<span class="built_in">compile</span>(<span class="string">&quot;((href|src|action)\s*=\s*\&quot;([^\&quot;&lt;&gt;]+)\&quot;)&quot;</span>, re.I)</span><br><span class="line">href_re2 = re.<span class="built_in">compile</span>(<span class="string">&quot;((href|src|action)\s*=\s*\&#x27;([^\&#x27;&lt;&gt;]+)\&#x27;)&quot;</span>, re.I)</span><br><span class="line">href_re3 = re.<span class="built_in">compile</span>(<span class="string">&quot;((href|src|action)\s*=\s*([^\&#x27;\&quot;\s&lt;&gt;]+))&quot;</span>, re.I)</span><br><span class="line">xmlhttprequest_re = re.<span class="built_in">compile</span>(<span class="string">&quot;&lt;script&quot;</span>, re.I)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rewrite</span>(<span class="params">proxyurl, baseurl, content</span>):</span><br><span class="line">    <span class="comment">#content = http_re.sub(proxyurl+&quot;\g&lt;0&gt;&quot;, content)</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">all</span>, href, url <span class="keyword">in</span> href_re1.findall(content):</span><br><span class="line">        rewrited_url = urlparse.urljoin(baseurl, url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rewrited_url.startswith(proxyurl) <span class="keyword">and</span> rewrited_url.startswith(<span class="string">&quot;http&quot;</span>):</span><br><span class="line">            content = content.replace(<span class="built_in">all</span>, <span class="string">&#x27;%s=&quot;%s%s&quot;&#x27;</span> % (href, proxyurl, rewrited_url))</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">all</span>, href, url <span class="keyword">in</span> href_re2.findall(content):</span><br><span class="line">        rewrited_url = urlparse.urljoin(baseurl, url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rewrited_url.startswith(proxyurl) <span class="keyword">and</span> rewrited_url.startswith(<span class="string">&quot;http&quot;</span>):</span><br><span class="line">            content = content.replace(<span class="built_in">all</span>, <span class="string">&#x27;%s=\&#x27;%s%s\&#x27;&#x27;</span> % (href, proxyurl, rewrited_url))</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">all</span>, href, url <span class="keyword">in</span> href_re3.findall(content):</span><br><span class="line">        rewrited_url = urlparse.urljoin(baseurl, url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rewrited_url.startswith(proxyurl) <span class="keyword">and</span> rewrited_url.startswith(<span class="string">&quot;http&quot;</span>):</span><br><span class="line">            content = content.replace(<span class="built_in">all</span>, <span class="string">&#x27;%s=&quot;%s%s&quot;&#x27;</span> % (href, proxyurl, rewrited_url))</span><br><span class="line">    content = content.replace(<span class="string">&quot;&lt;/title&gt;&quot;</span>, <span class="string">&quot;&lt;/title&gt;&lt;script&gt;%s&lt;/script&gt;&quot;</span> % xmlhttprequest % (proxyurl, urlparse.urljoin(baseurl, <span class="string">&quot;/&quot;</span>)), <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


<p><a target="_blank" rel="noopener" href="https://gist.github.com/3663115">https://gist.github.com/3663115</a></p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/python/">python</a>, <a href="/tags/BAE/">BAE</a>, <a href="/tags/proxy/">proxy</a>, <a href="/tags/webproxy/">webproxy</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="binux.blog">
  </form>
</div>


  <div class="widget tag about_me">
  <h3 class="title">About Me</h3>
  <ul class="entry">
    
    <li>
      <span class="icon email"></span>
      <a href="mailto:roy@binux.me" target=_blank rel=me>roy@binux.me</a>
    </li>
    

    
    <li>
      <span class="icon github"></span>
      <a href="https://github.com/binux" target=_blank rel=me>github.com/binux</a>
    </li>
    

    
    <li>
      <span class="icon twitter"></span>
      <a href="https://twitter.com/roybinux" target=_blank rel=me>@roybinux</a>
    </li>
    

    
    <li>
      <span class="icon gplus"></span>
      <a href="https://plus.google.com/+RoyBinux" target=_blank rel=me>+RoyBinux</a>
    </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2020/01/home-assistant/">家居自动化</a>
      </li>
    
      <li>
        <a href="/2019/03/zerotier-nat-gateway-and-iptables-debug/">Zerotier Nat 网关出口 和 iptables 调试</a>
      </li>
    
      <li>
        <a href="/2018/10/girls-frontline-ankulua-vision/">少女前线拖尸脚本 和 生成它的可视化工具</a>
      </li>
    
      <li>
        <a href="/2018/02/us/">2018 新的冒险</a>
      </li>
    
      <li>
        <a href="/2016/12/data-highlighter/">Data Highlighter</a>
      </li>
    
  </ul>
</div>


  <div class="widget tag recent-comments">
  <h3 class="title">近期评论</h3>
  <div class="entry">
    <script type="text/javascript" src="//binux.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=32&amp;excerpt_length=50"></script>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2022 Roy Binux
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>



<script>
var disqus_shortname = 'binux';
var disqus_config = function () {
this.page.url = 'https://binux.blog/2012/09/python-web-proxy-on-ba/';
this.page.identifier = 'https://binux.blog/2012/09/python-web-proxy-on-ba/';
};

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
