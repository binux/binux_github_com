<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>VPS配置记录（一） | Binuxの杂货铺</title>
  <meta name="author" content="Roy Binux">
  
  <meta name="description" content="一直想弄个VPS来玩，但都没有下定决心，随着人民币升值VPS变得更廉价，加上最近看到yardvps的圣诞节20%续费优惠码，算下来一个512M XEN的VPS也不过40RMB&amp;#x2F;月了。去除省去的VPN的钱，还算不错，于是决定入手一个玩玩。
稍微介绍一下吧，yardvps (推介链接)，是无管">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="VPS配置记录（一）"/>
  <meta property="og:site_name" content="Binuxの杂货铺"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
    <link rel="alternate" href="/atom.xml" title="Binuxの杂货铺" type="application/atom+xml">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-36392342-1', 'auto');
	ga('send', 'pageview');

</script>


<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Binuxの杂货铺</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/null">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/projects">Projects</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-vps-setup-log-1" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2011-12-24T19:33:03.000Z"><a href="/2011/12/vps-setup-log-1/">2011-12-24</a></time>
      
      
  
    <h1 class="p-name title" itemprop="headline name">VPS配置记录（一）</h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>一直想弄个VPS来玩，但都没有下定决心，随着<del>人民币升值</del>VPS变得更廉价，加上最近看到<a target="_blank" rel="noopener" href="http://www.yardvps.com/billing/aff.php?aff=1108">yardvps</a>的圣诞节20%续费优惠码，算下来一个512M XEN的VPS也不过40RMB&#x2F;月了。去除省去的VPN的钱，还算不错，于是决定入手一个玩玩。</p>
<p>稍微介绍一下吧，<a target="_blank" rel="noopener" href="http://www.yardvps.com/billing/aff.php?aff=1108">yardvps</a> (推介链接)，是无管理型的VPS提供商，机房位于洛杉矶，<strong>支持支付宝支付</strong>。<br>我选的这个VPS配置如下：</p>
<ul>
<li><p>内存：512 MB</p>
</li>
<li><p>SWAP：1 GB</p>
</li>
<li><p>CPU: 1 个 Intel(R) Xeon(R) CPU E5620 @ 2.40GHz</p>
</li>
<li><p>硬盘： 20GB</p>
</li>
<li><p>流量： 1500GB</p>
</li>
<li><p>原生IPV6、PPTP VPN</p>
</li>
</ul>
<p>由于有中文页面和新浪微博+支付宝，简直就是为中国人打造的。速度方面各地都不一样，到国内骨干网能有200-300KB&#x2F;S的速度。但是在我这（北京联通）还是挺悲剧的，也就30KB&#x2F;S的样子，而且丢包严重。。虽然也有其他地区朋友说速度不错。。不过最好还是亲自测试以下为好<br><a target="_blank" rel="noopener" href="http://208.87.242.2/download100.zip">官方测速100M</a>，<a target="_blank" rel="noopener" href="http://ipv4.binux.me/CSDN-%e4%b8%ad%e6%96%87IT%e7%a4%be%e5%8c%ba-600%e4%b8%87.rar">位于我服务器上的文件</a></p>
<p>好，推介到此结束，下面正式开始，服务器系统用的是ArchLinux 64位版本，因为用得比较习惯了。。而且默认配置文件的分布还是比较舒服的。。</p>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>用adduser的交互式用户添加，比起useradd各种命令参数省心很多：</p>
<pre><code>[root@localhost http]# adduser
Login name for new user []: binux
User ID (&#39;UID&#39;) [ defaults to next available ]: 
Initial group [ users ]: 
Additional groups (comma separated) []: bin,daemon,sys,adm,disk,wheel,log,audio
Home directory [ /home/binux ] 
Shell [ /bin/bash ] 
Expiry date (YYYY-MM-DD) []: 

New account will be created as follows:
---------------------------------------
Login name.......:  binux
UID..............:  [ Next available ]
Initial group....:  users
Additional groups:  bin,daemon,sys,adm,disk,wheel,log,audio
Home directory...:  /home/binux
Shell............:  /bin/bash
Expiry date......:  [ Never ]

This is it... if you want to bail out, hit Control-C.  Otherwise, press
ENTER to go ahead and make the account.
</code></pre>
<h3 id="x2F-etc-x2F-sudoers"><a href="#x2F-etc-x2F-sudoers" class="headerlink" title="&#x2F;etc&#x2F;sudoers"></a>&#x2F;etc&#x2F;sudoers</h3><p>由于我都是用sshkey验证登录的，总是不记得密码，于是给wheel组加上了免密码sudo，至于为什么不直接用root是因为这样可以防止手抖。。</p>
<pre><code>[root@localhost binux]# sudoedit /etc/sudoers

## Same thing without a password
-# %wheel ALL=(ALL) NOPASSWD: ALL
+%wheel ALL=(ALL) NOPASSWD: ALL

## Uncomment to allow members of group sudo to execute any command
-# %sudo   ALL=(ALL) ALL
+%sudo   ALL=(ALL) ALL
</code></pre>
<p>然后就是改掉密码什么的</p>
<h3 id="pacman-amp-amp-python-amp-amp-vim"><a href="#pacman-amp-amp-python-amp-amp-vim" class="headerlink" title="pacman &amp;&amp; python &amp;&amp; vim"></a>pacman &amp;&amp; python &amp;&amp; vim</h3><p>随手打开一些源</p>
<pre><code>[root@localhost ~]# vi /etc/pacman.d/mirrorlist
Server = http://mirrors.kernel.org/archlinux/$repo/os/$arch





[root@localhost ~]# pacman -Sy
[root@localhost ~]# pacman -S python
[root@localhost ~]# pacman -S python2
[root@localhost ~]# pacman -S vim
</code></pre>
<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><pre><code>pacman -S nginx





[root@localhost ~]# vim /etc/nginx/conf/nginx.conf

-#user http;
+user http;

-    #keepalive_timeout  65;
+    keepalive_timeout  20;

-    #gzip  on;
+    gzip  on;

    server &#123;
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / &#123;
-            root   http;
+            root   /srv/http;
            index  index.html index.htm;
            autoindex on;
        &#125;

     &#125;

+    include vhost/*.conf;
</code></pre>
<p>这里我们已经把nginx的目录统一放到&#x2F;srv&#x2F;http下了。为了让nginx所在的http组也能访问修改这个路径，把这个目录的所有人改成http，然后将binux也加入这个组来修改里面的文件。<br>然后建立vhost目录，然后include到主配置中来，为了以后方便添加虚拟主机。</p>
<pre><code>[root@localhost conf]# cd /etc/nginx/conf/
[root@localhost conf]# mkdir vhost

[root@localhost conf]# cd /srv/
[root@localhost srv]# chown http:http http
[root@localhost srv]# chmod 775 http
[root@localhost srv]# usermod -a -G http binux

[root@localhost srv]# rc.d start nginx
</code></pre>
<h3 id="PPTP-Server"><a href="#PPTP-Server" class="headerlink" title="PPTP Server"></a>PPTP Server</h3><p>参考：<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/PPTP_Server_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">https://wiki.archlinux.org/index.php/PPTP_Server_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</a></p>
<pre><code>[root@localhost ~]# pacman -S pptpd
[root@localhost ~]# vim /etc/pptpd.conf

+3行
option /etc/ppp/pptpd-options
localip 172.16.36.1
remoteip 172.16.36.2-254

[root@localhost ~]# vim /etc/ppp/pptpd-options

+14行
name pptpd
refuse-pap
refuse-chap
refuse-mschap
require-mschap-v2
require-mppe-128
proxyarp
lock
nobsdcomp
novj
novjccomp
nologfd
ms-dns 8.8.8.8
ms-dns 8.8.4.4

[root@localhost ~]# vim /etc/ppp/chap-secrets

+binux   pptpd   passwd  *

[root@localhost ~]# vim /etc/sysctl.conf

# Disable packet forwarding
-net.ipv4.ip_forward=0
+net.ipv4.ip_forward=1

[root@localhost ~]# iptables -A INPUT -i ppp+ -j ACCEPT
[root@localhost ~]# iptables -A OUTPUT -o ppp+ -j ACCEPT

[root@localhost ~]# iptables -A INPUT -p tcp --dport 1723 -j ACCEPT
[root@localhost ~]# iptables -A INPUT -p 47 -j ACCEPT
[root@localhost ~]# iptables -A OUTPUT -p 47 -j ACCEPT

[root@localhost ~]# iptables -F FORWARD
[root@localhost ~]# iptables -A FORWARD -j ACCEPT
[root@localhost ~]# iptables -A POSTROUTING -t nat -o eth0 -j MASQUERADE
[root@localhost ~]# iptables -A POSTROUTING -t nat -o ppp+ -j MASQUERADE

[root@localhost ~]# rc.d save iptables
</code></pre>
<p>然后在线启用端口转发，然后可以启用pptpd了。</p>
<pre><code>echo 1 &gt;/proc/sys/net/ipv4/ip_forward
rc.d start pptpd
</code></pre>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>, <a href="/tags/arch/">arch</a>, <a href="/tags/archlinux/">archlinux</a>, <a href="/tags/nginx/">nginx</a>, <a href="/tags/pptpd/">pptpd</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="as_sitesearch" value="binux.blog">
  </form>
</div>


  <div class="widget tag about_me">
  <h3 class="title">About Me</h3>
  <ul class="entry">
    
    <li>
      <span class="icon email"></span>
      <a href="mailto:roy@binux.me" target=_blank rel=me>roy@binux.me</a>
    </li>
    

    
    <li>
      <span class="icon github"></span>
      <a href="https://github.com/binux" target=_blank rel=me>github.com/binux</a>
    </li>
    

    
    <li>
      <span class="icon twitter"></span>
      <a href="https://twitter.com/roybinux" target=_blank rel=me>@roybinux</a>
    </li>
    

    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2022/08/cat-planet-bot-part-1-touch-simulation/">猫之城物理钓鱼挂（一）：物理模拟触屏点击</a>
      </li>
    
      <li>
        <a href="/2020/01/home-assistant/">家居自动化</a>
      </li>
    
      <li>
        <a href="/2019/03/zerotier-nat-gateway-and-iptables-debug/">Zerotier Nat 网关出口 和 iptables 调试</a>
      </li>
    
      <li>
        <a href="/2018/10/girls-frontline-ankulua-vision/">少女前线拖尸脚本 和 生成它的可视化工具</a>
      </li>
    
      <li>
        <a href="/2018/02/us/">2018 新的冒险</a>
      </li>
    
  </ul>
</div>


  <div class="widget tag recent-comments">
  <h3 class="title">近期评论</h3>
  <div class="entry">
    <script type="text/javascript" src="//binux.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=32&amp;excerpt_length=50"></script>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2022 Roy Binux
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>



<script>
var disqus_shortname = 'binux';
var disqus_config = function () {
this.page.url = 'https://binux.blog/2011/12/vps-setup-log-1/';
this.page.identifier = 'https://binux.blog/2011/12/vps-setup-log-1/';
};

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script>
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
